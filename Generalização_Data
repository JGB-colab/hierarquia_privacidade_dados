import pandas as pd
import numpy as np

# Carregar o dataframe

df = pd.read_csv('/content/dados_covid-ce_trab02.csv', encoding='latin-1')
df['dataNascimento'] = pd.to_datetime(df['dataNascimento'], errors='coerce')
df['dataNascimento'] = pd.to_datetime(df['dataNascimento'])
def generalizar(df):

    print("Informe a porcentagem de cada nível de generalização (total deve somar 100)")
    n0 = float(input("Nível 0 (dia/mês/ano): (Exemplo: 20,30, 40)"))
    n1 = float(input("Nível 1 (mês/ano): (Exemplo: 20,30, 40)"))
    n2 = float(input("Nível 2 (ano): (Exemplo: 20,30, 40)"))

    # Verificar se realmente o total daa 100% do dataframe
    total = n0 + n1 + n2
    if total != 100:
        print(f"A soma deve ser 100, mas foi {total}.")
        return

    # Cria uma cópia

    df_copy = df.copy()

    # Calcula o número de linhas para cada nível
    n = len(df_copy)
    line_n0 = int(n * n0 / 100)
    line_n1 = int(n * n1 / 100)
    line_n2 = n - line_n0 - line_n1 # Calculate line_n2 to account for potential rounding issues

    #Cria um index para classificar o nivel de acordo com a quantidade de linhas que é preciso.
    index0 = df_copy.index[:line_n0]#Totas as linhas até a quantidade de linhas de nivel0
    index1 = df_copy.index[line_n0:line_n0+line_n1]#A partir do line_n0 preenche com o nivel 1 até o line_n0+line_n1
    index2 = df_copy.index[line_n0+line_n1:line_n0+line_n1+line_n2]#Todas as linhas após line_n0 + line_n1, preenche com o nivel2

    # Aplica as generalizações com base no index
    valn0 = df_copy.loc[index0, 'dataNascimento'].dt.strftime('%d/%m/%Y') #Localiza as linhas com o index do nivel 0 e aplica a generalização dia/mês/ano
    valn1 = df_copy.loc[index1, 'dataNascimento'].dt.strftime('%m/%Y') #Localiza as linhas com o index do nivel 1 e aplica a generalização mês/ano
    valn2 = df_copy.loc[index2, 'dataNascimento'].dt.strftime('%Y') ##Localiza as linhas com o index do nivel 2 e aplica a generalização ano
    
    # 2. Passar a coluna para 'object' para aceitar as strings
    df_copy['dataNascimento'] = df_copy['dataNascimento'].astype(object)

    # 3. Realizar a alteração na coluna (atribuindo as strings)
    df_copy.loc[index0, 'dataNascimento'] = valn0
    df_copy.loc[index1, 'dataNascimento'] = valn1
    df_copy.loc[index2, 'dataNascimento'] = valn2

    print("Generalização")
    print(f"- Nível 0: {line_n0} linhas ({n0}%)")
    print(f"- Nível 1: {line_n1} linhas ({n1}%)")
    print(f"- Nível 2: {line_n2} linhas ({n2}%)")
    display(df_copy['dataNascimento'])
    return df_copy

# Executar
generalizar(df)
